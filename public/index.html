<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Experimento caida libre</title>
    <link rel="stylesheet" href="css/main.css">

    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script defer src="/__/firebase/8.3.3/firebase-app.js"></script>
    <script defer src="/__/firebase/8.3.3/firebase-database.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>
    <script src="https://raw.githubusercontent.com/google/palette.js/master/palette.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <div id="load">

        <!-- Tabs -->
        <section id="tabs">
            <div class="container">
                <h6 class="section-title h1">PROYECTO CAIDA LIBRE</h6>
                <div class="row mt-5">
                    <div class="col-xs-12 col-sm-12">
                        <nav>
                            <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                                <a class="nav-item nav-link active" id="nav-teoria-tab" data-toggle="tab" href="#nav-teoria" role="tab" aria-controls="nav-teoria" aria-selected="true">TEORÍA</a>
                                <a class="nav-item nav-link" id="nav-experimento-tab" data-toggle="tab" href="#nav-experimento" role="tab" aria-controls="nav-experimento" aria-selected="false">EXPERIMENTO</a>
                                <a class="nav-item nav-link" id="nav-acerca-tab" data-toggle="tab" href="#nav-acerca" role="tab" aria-controls="nav-acerca" aria-selected="false">ACERCA</a>
                            </div>
                        </nav>
                        <div class="tab-content py-3 px-3 px-sm-0" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-teoria" role="tabpanel" aria-labelledby="nav-teoria-tab">
                                Et et consectetur ipsum labore excepteur est proident excepteur ad velit occaecat qui minim occaecat veniam. Fugiat veniam incididunt anim aliqua enim pariatur veniam sunt est aute sit dolor anim. Velit non irure adipisicing aliqua ullamco irure incididunt
                                irure non esse consectetur nostrud minim non minim occaecat. Amet duis do nisi duis veniam non est eiusmod tempor incididunt tempor dolor ipsum in qui sit. Exercitation mollit sit culpa nisi culpa non adipisicing reprehenderit
                                do dolore. Duis reprehenderit occaecat anim ullamco ad duis occaecat ex.
                            </div>
                            <div class="tab-pane fade" id="nav-experimento" role="tabpanel" aria-labelledby="nav-experimento-tab">
                                <h3 class="mb-5">
                                    Introduce los datos a continuación
                                </h3>
                                <form class="form_exp" id="form_exp">
                                    <div class="form-group row">
                                        <label for="distancia" class="col-4 col-form-label">Distancia de 10cm - 70cm</label>
                                        <div class="col-8">
                                            <select id="distancia" name="distancia" class="form-control">
                        <option value="10" selected>10 cm</option>
                        <option value="20">20 cm</option>
                        <option value="30">30 cm</option>
                        <option value="40">40 cm</option>
                        <option value="50">50 cm</option>
                        <option value="60">60 cm</option>
                        <option value="70">70 cm</option>
                      </select>
                                            <!-- <input id="distancia" name="distancia" min="5" max="100" value="5" step="5" placeholder="Distancia" type="number" required="required" class="form-control"> -->
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <label for="repeticiones" class="col-4 col-form-label">Repeticiones de 1 a 3</label>
                                        <div class="col-8">
                                            <select id="repeticiones" name="repeticiones" class="form-control">
                        <option value="1" selected>1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                      </select>
                                            <!-- <input id="repeticiones" name="repeticiones" value="2" min="1" max="5" step="1" placeholder="Repeticiones" type="number" class="form-control"> -->
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="offset-4 col-8">
                                            <button name="submit" type="submit" id="enviar" class="btn btn-primary">ENVIAR</button>
                                        </div>
                                    </div>
                                </form>
                                <div>
                                    <button id="test"> TEST</button>
                                    <canvas id="myChart"></canvas>
                                </div>


                            </div>
                            <div class="tab-pane fade" id="nav-acerca" role="tabpanel" aria-labelledby="nav-acerca-tab">
                                Et et consectetur ipsum labore excepteur est proident excepteur ad velit occaecat qui minim occaecat veniam. Fugiat veniam incididunt anim aliqua enim pariatur veniam sunt est aute sit dolor anim. Velit non irure adipisicing aliqua ullamco irure incididunt
                                irure non esse consectetur nostrud minim non minim occaecat. Amet duis do nisi duis veniam non est eiusmod tempor incididunt tempor dolor ipsum in qui sit. Exercitation mollit sit culpa nisi culpa non adipisicing reprehenderit
                                do dolore. Duis reprehenderit occaecat anim ullamco ad duis occaecat ex.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const data = {
                datasets: []
            };
            const config = {
                type: 'scatter',
                data: data,
                options: {
                    tooltips: {
                        mode: 'index',
                        intersect: false,
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    scales: {

                        y: {
                            title: {
                                display: true,
                                text: 'Distancia de caida libre (cm)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Tiempo (micro segundos)'
                            }
                        },
                        yAxes: [{
                                scaleLabel: {
                                    display: true,
                                    labelString: 'probability'
                                }
                            },

                        ]
                    },
                }
            };
            const myChart = new Chart(
                document.getElementById('myChart'),
                config
            );

            const loadEl = document.querySelector('#load');
            let counter = 0;
            let data_resp = [];

            firebase.database().ref('experimento').on('value', snapshot => {
                counter = snapshot.val().counter;
                data_resp = snapshot.val().data;
                console.log('data resp', data_resp);
                $('#enviar').attr('disabled', false);
                if (data_resp !== undefined) {
                    setGraph(data_resp);
                }
            });


            $("#test").click(function(event) {
                event.preventDefault();
                setGraph(data_resp);

                myChart.update();

            });

            function setGraph(data_resp) {
                myChart.config.data.datasets = [];
                console.log(data_resp);

                let labels_data = []
                let repetition = []
                let map_xy = [
                    []
                ];

                for (let i = 0; i < data_resp.length; i++) {
                    map_xy[i] = []
                    repetition = data_resp[i];
                    for (let j = 0; j < repetition.length; j++) {
                        map_xy[i][j] = {
                            x: repetition[j],
                            y: j * 10
                        }
                    }
                }

                for (let i = 0; i < map_xy.length; i++) {
                    myChart.config.data.datasets.push({
                        label: `Repetición: ${i+1}`,
                        data: map_xy[i],
                        showLine: true,
                        fill: false,
                        backgroundColor: '#ff0000',
                        borderColor: '#' + Math.floor(Math.random() * 16777215).toString(16)
                    })

                }
                console.log('map_xy', map_xy)

            }


            $("#enviar").click(function(event) {
                $('#enviar').attr('disabled', true);

                event.preventDefault();
                const distancia = $('#distancia').val();
                const repeticiones = $('#repeticiones').val();
                console.log('distancia: ', distancia, 'repeticiones: ', repeticiones);
                counter = counter + 1;

                firebase.database().ref('experimento').set({
                    distancia: distancia,
                    repeticiones: repeticiones,
                    counter: counter
                }, (error) => {
                    if (error) {
                        console.log('error: ', error);
                    } else {
                        console.log('Data saved successfully');
                    }
                });
            });

        });
    </script>
</body>

</html>